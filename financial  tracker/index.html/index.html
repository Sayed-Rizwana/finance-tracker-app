<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Finance Tracker Pro</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f6f8; margin:0; padding:20px; transition: background 0.3s, color 0.3s; }
    h1 { text-align: center; color: #333; }
    #container { max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); transition: background 0.3s, color 0.3s; }
    .balance { font-size: 24px; margin: 15px 0; }
    .income, .expense { font-size: 18px; margin: 10px 0; }
    .plus { color: green; }
    .minus { color: red; }
    form { margin: 20px 0; }
    input, select, button { padding: 10px; margin: 5px 0; width: 100%; border: 1px solid #ccc; border-radius: 5px; }
    button { background: #007bff; color: white; cursor: pointer; font-size: 16px; }
    button:hover { background: #0056b3; }
    ul { list-style: none; padding: 0; }
    li { background: #f9f9f9; padding: 10px; margin: 5px 0; border-left: 5px solid; display: flex; justify-content: space-between; align-items: center; }
    li.plus { border-color: green; }
    li.minus { border-color: red; }
    li button { background: red; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 3px; }
    li button:hover { background: darkred; }
    .charts { margin-top: 30px; }
    canvas { margin-top: 20px; }
    .dark-mode { background: #222; color: white; }
    .dark-mode #container { background: #333; color: white; }
    .filters { margin: 15px 0; display: flex; justify-content: space-between; }
    .stats { margin-top: 20px; padding: 15px; background: #f1f1f1; border-radius: 8px; }
    .dark-mode .stats { background: #444; }
  </style>
</head>
<body>
  <div id="container">
    <h1>Finance Tracker Pro ðŸ’°</h1>
    <button onclick="toggleDarkMode()">ðŸŒ™ Toggle Dark Mode</button>
    <div class="balance">Balance: â‚¹<span id="balance">0</span></div>
    <div class="income">Income: <span class="plus">+â‚¹<span id="income">0</span></span></div>
    <div class="expense">Expense: <span class="minus">-â‚¹<span id="expense">0</span></span></div>
    
    <form id="transactionForm">
      <input type="text" id="desc" placeholder="Enter description" required>
      <input type="number" id="amount" placeholder="Enter amount (+ for income, - for expense)" required>
      <select id="category" required>
        <option value="">Select Category</option>
        <option value="Food">Food</option>
        <option value="Travel">Travel</option>
        <option value="Bills">Bills</option>
        <option value="Shopping">Shopping</option>
        <option value="Salary">Salary</option>
        <option value="Others">Others</option>
      </select>
      <input type="month" id="date" required>
      <button type="submit">Add Transaction</button>
    </form>

    <div class="filters">
      <input type="text" id="search" placeholder="Search by description...">
      <select id="monthFilter">
        <option value="all">All Months</option>
      </select>
      <button onclick="exportCSV()">ðŸ“‚ Export CSV</button>
    </div>

    <h3>History</h3>
    <ul id="list"></ul>

    <div class="stats">
      <h3>Summary ðŸ“Š</h3>
      <p>Total Transactions: <span id="totalTrans">0</span></p>
      <p>Highest Income: â‚¹<span id="highIncome">0</span></p>
      <p>Highest Expense: â‚¹<span id="highExpense">0</span></p>
    </div>

    <div class="charts">
      <h3>Spending Overview</h3>
      <canvas id="pieChart"></canvas>
      <canvas id="barChart"></canvas>
    </div>
  </div>

  <script>
    const balanceEl = document.getElementById('balance');
    const incomeEl = document.getElementById('income');
    const expenseEl = document.getElementById('expense');
    const listEl = document.getElementById('list');
    const form = document.getElementById('transactionForm');
    const descInput = document.getElementById('desc');
    const amountInput = document.getElementById('amount');
    const categoryInput = document.getElementById('category');
    const dateInput = document.getElementById('date');
    const searchInput = document.getElementById('search');
    const monthFilter = document.getElementById('monthFilter');
    const pieCtx = document.getElementById('pieChart').getContext('2d');
    const barCtx = document.getElementById('barChart').getContext('2d');
    const totalTransEl = document.getElementById('totalTrans');
    const highIncomeEl = document.getElementById('highIncome');
    const highExpenseEl = document.getElementById('highExpense');

    let transactions = JSON.parse(localStorage.getItem("transactions")) || [];

    let pieChart = new Chart(pieCtx, {
      type: 'pie',
      data: { labels: ['Income', 'Expense'], datasets: [{ data: [0, 0], backgroundColor: ['#28a745', '#dc3545'] }] }
    });

    let barChart = new Chart(barCtx, {
      type: 'bar',
      data: { labels: ['Food','Travel','Bills','Shopping','Salary','Others'], datasets: [{ label: 'Expenses by Category', data: [0,0,0,0,0,0], backgroundColor: '#007bff' }] },
      options: { scales: { y: { beginAtZero: true } } }
    });

    function updateCharts(income, expense) {
      pieChart.data.datasets[0].data = [income, expense];
      pieChart.update();

      let categories = ['Food','Travel','Bills','Shopping','Salary','Others'];
      let categoryTotals = [0,0,0,0,0,0];
      transactions.forEach(t => {
        if (t.amount < 0) {
          let idx = categories.indexOf(t.category);
          if (idx !== -1) categoryTotals[idx] += Math.abs(t.amount);
        }
      });
      barChart.data.datasets[0].data = categoryTotals;
      barChart.update();
    }

    function updateValues() {
      let filtered = filterTransactions();
      const amounts = filtered.map(t => t.amount);
      const total = amounts.reduce((acc, item) => acc + item, 0).toFixed(2);
      const income = amounts.filter(a => a > 0).reduce((acc, item) => acc + item, 0).toFixed(2);
      const expense = (amounts.filter(a => a < 0).reduce((acc, item) => acc + item, 0) * -1).toFixed(2);

      balanceEl.innerText = total;
      incomeEl.innerText = income;
      expenseEl.innerText = expense;

      totalTransEl.innerText = filtered.length;
      highIncomeEl.innerText = Math.max(0, ...filtered.filter(t => t.amount > 0).map(t => t.amount));
      highExpenseEl.innerText = Math.max(0, ...filtered.filter(t => t.amount < 0).map(t => Math.abs(t.amount)));

      updateCharts(income, expense);
      localStorage.setItem("transactions", JSON.stringify(transactions));
    }

    function addTransaction(e) {
      e.preventDefault();
      const transaction = {
        id: Math.floor(Math.random() * 1000000),
        desc: descInput.value,
        amount: +amountInput.value,
        category: categoryInput.value,
        date: dateInput.value
      };
      transactions.push(transaction);
      init();
      descInput.value = ''; amountInput.value = ''; categoryInput.value = ''; dateInput.value = '';
    }

    function addTransactionDOM(transaction) {
      const sign = transaction.amount < 0 ? '-' : '+';
      const item = document.createElement('li');
      item.classList.add(transaction.amount < 0 ? 'minus' : 'plus');
      item.innerHTML = `${transaction.desc} (${transaction.category}) [${transaction.date}] 
        <span>${sign}â‚¹${Math.abs(transaction.amount)}</span>
        <button onclick="removeTransaction(${transaction.id})">x</button>`;
      listEl.appendChild(item);
    }

    function removeTransaction(id) {
      transactions = transactions.filter(t => t.id !== id);
      init();
    }

    function filterTransactions() {
      let month = monthFilter.value;
      let search = searchInput.value.toLowerCase();
      return transactions.filter(t => {
        let matchMonth = month === "all" || (t.date && t.date.startsWith(month));
        let matchSearch = t.desc.toLowerCase().includes(search);
        return matchMonth && matchSearch;
      });
    }

    function init() {
      listEl.innerHTML = '';
      let filtered = filterTransactions();
      filtered.forEach(addTransactionDOM);
      updateValues();
    }

    function toggleDarkMode() { document.body.classList.toggle("dark-mode"); }

    function exportCSV() {
      let rows = [["Description","Amount","Category","Date"]];
      transactions.forEach(t => rows.push([t.desc,t.amount,t.category,t.date]));
      let csv = rows.map(r => r.join(",")).join("\n");
      let blob = new Blob([csv], { type: "text/csv" });
      let url = URL.createObjectURL(blob);
      let a = document.createElement("a");
      a.href = url; a.download = "finance_data.csv"; a.click();
    }

    form.addEventListener('submit', addTransaction);
    searchInput.addEventListener('input', init);
    monthFilter.addEventListener('change', init);

    function populateMonths() {
      let months = [...new Set(transactions.map(t => t.date.slice(0,7)))];
      months.forEach(m => {
        if (![...monthFilter.options].some(opt => opt.value === m)) {
          let opt = document.createElement("option");
          opt.value = m; opt.innerText = m; monthFilter.appendChild(opt);
        }
      });
    }

    function start() { populateMonths(); init(); }
    start();
  </script>
</body>
</html>
